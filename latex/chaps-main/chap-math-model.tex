\chapter{Maths Model}

\section{Overview and objectives}

This project develops a system of equations to analytically model the climbing motion of the device, which will be referred to as the, "Maths Model" henceforth. The intention behind this model is to allow designers to input parameters such as gear ratio, mass, wheel size, tail length, and motor torque, then determine whether the specified device will be able to climb steps. The equations can also reversed to solve for specific parameters, such as the motor torque required to lift a device with certain properties. The maths model is developed using the MATLAB symbolic toolbox.\\

\section{Definition of motions}

As a LIMed device climbs, the tail and wheels come into contact with different surfaces on the stairs and ground, which changes how the device moves. The overall climbing motion is broken down into sequential stages which are modelled individually. These stages are defined as follows:\\
\subsection*{Stage 0: Rolling}

When the LIMed device does is on a flat plane with no obstacle, it simply rolls forward. If the motor torque is high enough, the LIMs will flip even without an obstacle. However, DC motors lose torque as they gain speed, so the rolling motion prevents the motors from producing enough torque to flip the LIMs.\\

\subsection*{Stage 1: Lifting}
When the front wheel of the LIM comes into contact with the first step, it is blocked by a step and fixed in place. The tail pushes against the ground and the LIM starts rotating up the step. This motion ends when the LIM is vertical.
\\
\subsection*{Stage 2: Flipping}

Once the LIM is vertical, the bottom wheel starts to roll backwards as the top wheel falls forward onto the step. The distance that the bottom wheel rolls depends on the speed of the LIM and the height of the step. If the frame of the LIM hits the edge of the step, the device may slip backwards until the top wheel makes contact with the step. This motion ends when the top wheel is on the step.\\

\subsection*{Stage 3: Climbing}

The front wheel rests on the step while the back wheel is on the ground. The tail pushes against the ground and the back wheel lifts while the front wheel simultaneously rolls forward on the step. This motion ends when the front wheel reaches the next step.\\

Stages 1 to 3 will repeat until the tail leaves the ground. After this point the tail will push against the edge of the previous steps. 

\subsection*{Stage 4: Lifting from step}

Similar to Stage 1, but the tail pushes against the edge of a the previous step, which now applies a force pulling the device backwards. Assuming friction on the wheel is sufficient, the LIM starts rotating up the step. This motion ends when the LIM is vertical.

\subsection*{Stage 5: Flipping from step}

Similar to Stage 2, but the tail pushes against the edge of a the previous step, which now applies a force pulling the device backwards. This motion ends when the top wheel is on the step.\\

\subsection*{Stage 6: Climbing from step}

Similar to Stage 3, but the tail pushes against the edge of a the previous step, which now applies a force pulling the device backwards. The back wheel lifts while the front wheel rolls forward on the step. This motion ends when the front wheel reaches the next step; however, due to the tail force pulling the device backwards, the back wheel will continue to lift past the horizontal while front wheel rolls forward.\\


\section{Core equations and assumptions}

The maths model is consists of a system of equations that are solved simultaneously. These equations are derived from the free body diagrams of each component, and only consider movement in two dimensions. The components in question are the LIM frame, the sun gear, the idler gears, and the planet gears including the shaft and the wheels, and the body of the device. These components make contact with the surroundings and the other components, which exert equal and opposite forces on each other. As the maths model only considers movement in two dimensions, the LIMs are assumed to move synchronously. To simplify the equations, only one LIM is modelled, and its mass and moment of inertia is doubled.\\
The free body diagrams for each component are shown in figure ???.\\
\\
Each component is assigned a number, where the LIM frame is 1, the sun gear is 2, the idler gears are 3 and 4, the planet gears are 5 and 6, and the body of the device, including the tail, is 7.
For example, the the sum of forces equations for the sun gear are,\\
\begin{equation}
	m_2\vec{a_2} == \vec{w_2}-\vec{f_2}+\vec{\mathrm{gf}_3}+\vec{\mathrm{gf}_4}
\end{equation}
Where $m_x$ refers to the mass of component $x$, $\vec{a_x}$ is the acceleration vector of component $x$, $\vec{w_x}$ is the weight vector of component $x$, $\vec{f_x}$ is the force vector that component $x$ applies to component 1,  and $\vec{\mathrm{gf}_3}$ and $\vec{\mathrm{gf}_4}$ are the force vectors that components 3 and 4 respectively apply to component 2 through the gears.
This can be expanded to,
\begin{equation}
	m_2
	\begin{bmatrix}
		a_{21}\\
		a_{22}\\
		a_{23}\\
	\end{bmatrix}
	=
	\begin{bmatrix}
		w_{21}-f_{21}+\mathrm{gf}_{31}+\mathrm{gf}_{41}\\
		w_{22}-f_{22}+\mathrm{gf}_{32}+\mathrm{gf}_{42}\\
		w_{23}-f_{23}+\mathrm{gf}_{33}+\mathrm{gf}_{43}\\
	\end{bmatrix}
\end{equation}
where vector positions 1, 2, and 3 denote the x, y, and z dimensions respectively. This equation can be further simplified by restraining movement to the x and y dimensions, and substituting $\vec{w_2} = \begin{bmatrix} 0 & m_2g & 0 \end{bmatrix}'$,
\begin{equation}
	m_2
	\begin{bmatrix}
		a_{21}\\
		a_{22}\\
	\end{bmatrix}
	=
	\begin{bmatrix}
		-f_{21}+\mathrm{gf}_{31}+\mathrm{gf}_{41}\\
		m_2g-f_{22}+\mathrm{gf}_{32}+\mathrm{gf}_{42}\\
	\end{bmatrix}
\end{equation}
Similarly, the sum of moments equation for the sun gear is derived
\begin{equation}
	I_2\ddot{\theta_2} == T - r_2|\vec{\mathrm{gf}_3}| + r_2|\vec{\mathrm{gf}_3}|
\end{equation}
where $I_2$ is the moment of inertia of component 2, $\theta_2$ is the angle of component 2, $T$ is the moment exerted by the motor on component 2, and $r_2$ is the radius of component 2. Note that in this project, all angles and moments are given in the clockwise direction.
\\
The full list of equations can be found in appendix ??? and in the matlab code.



\section{Boundary conditions}
Depending on the stage of the climbing, components of the device will come into contact with different parts of the steps and at different angles. To model climbing in each stage, a set of equations defining the contact is given for each stage.\\
\subsection*{Stage 1: Lifting}
The front wheel, referred to as component 5, is locked in place by the reaction forces from the step, this leads to the condition,
\begin{subequations}
	\label{wheel1locked}
	\begin{align}
		\vec{a_5} &= \vec{0}\\
		\vec{v_5} &= \vec{0}\\
		\dot{\theta}_5 &= 0\\
		\ddot{\theta}_5 &= 0
	\end{align}
\end{subequations}
where $\vec{v_x}$ refers to the velocity of component $x$.\\
The front wheel must be placed into a two dimensional coordinate system. In stage 1, the front wheel can be on the ground or on one of the steps, so long as the tail can reach the ground, and the front wheel will always be pressed against the edge of the next step. Placing the origin at the start of the steps as seen in Figure ???, the position of the wheel can be defined as,
\begin{equation}
	\vec{s_5}
	=
	\begin{bmatrix}
		\mathrm{StepWidth}\cdot N-r_w\\
		\mathrm{StepHeight}\cdot N+r_w\\
		0
	\end{bmatrix}
\end{equation}
where $\vec{s_5}$ is the position vector of the centre of the front wheel, $N$ is the number of the step on which the wheel is placed, with $N = 0$ placing the step on the ground, and $r_w$ is the radius of the wheel.\\
The end of the tail pushes against the ground, which leads to the following conditions,
\begin{subequations}
	\label{tailonground}
	\begin{align}
		s_{7end2} &= 0\\
		F_{react71} &=  -\mu_{tail}F_{react72}\\
		\ddot{\theta_7} &= \frac{(|\vec{l_7}|^2 - l_{72}^2)a_{12} + l_{72}v_{12}^2}{|\vec{l_7}|^3 (1 - \frac{l_{72}^2}{|\vec{l_7}|^2})^{3/2}} \label{tailongroundkinematics}
	\end{align}
\end{subequations}
where $s_{7end2}$ is the y position of the endpoint of the tail, $F_{react71}$ and $F_{react72}$ are the reaction forces exerted onto the tail by the ground in the x and y dimensions respectively, $\mu_{tail}$ is the coefficient of friction between the tail and the ground, $\vec{l_7}$ is the position of the end of the tail relative to the motor axle, and $l_{72}$ is the component of $\vec{l_7}$ in the y dimension. \\
Equation \ref{tailongroundkinematics} is derived from,

\begin{subequations}
	\begin{align}
		\theta_7(t) &= \arcsin{\frac{l_{72}(t)}{|\vec{l_7}|}}\\
		\frac{d^2}{dt^2}\theta_7(t) &= \frac{d^2}{dt^2}\arcsin{\frac{l_{72}(t)}{|\vec{l_7}|}}
	\end{align}
\end{subequations}
where $\theta_7$ and $l_{72}$ are treated as functions of time, $t$. This relation can be seen in figure ???. $v_{12}$ and $a_{12}$ refer to the velocity and acceleration of the motor axle in the y dimension, and are equivalent to $\dot{l_{72}}$ and $\ddot{l_{72}}$ respectively.\\

\subsection*{Stage 2: Flipping}

Once the LIM is vertical, there is no longer a force pushing the bottom wheel forward into the step, instead it rolls backwards. This leads to a new condition,
\begin{subequations}
	\label{wheel1rolling}
	\begin{align}
		\vec{a_5} &= \begin{bmatrix}
			\ddot{\theta}_5 r_w \\
			0\\
			0
		\end{bmatrix}\\
		\vec{v_5} &= \begin{bmatrix}
			\dot{\theta}_5 r_w \\
			0\\
			0
		\end{bmatrix}\\
		s_{51} &= \theta_{5} r_w;\\
		M_{react5} &= - F_{react51} r_w;
	\end{align}
\end{subequations}
where $M_{react5}$ is the reaction moment on wheel 5 as a result of the reaction forces.
The tail is still on the ground, so will still be subject to Equations \ref{tailonground}.

\subsection*{Stage 3: Climbing}

In Stage 3, the front and back wheel have swapped. To simplify the movements, component 5 will always refer to the wheel that makes contact with the steps, and component 6 will refer to the wheel that does not. \\
The front wheel is rolling and the tail is on the ground, which are the same conditions as in Stage 2. As such, Stage 3 is subject to Equations \ref{wheel1rolling} and \ref{tailonground}.

\subsection*{Stage 4: Lifting with tail on step}
Stage 4 is similar to stage 1, except the tail is on the step. As such, this motion is subject to Equations \ref{wheel1locked} because the wheel is locked, and a set of new conditions because the tail is on the edge of the step,

\begin{subequations}
	\label{tailonstep}
	\begin{align}
		u_1 &= \mathrm{StepWidth}\cdot (N_2-1)- s_{11}\\
		u_2 &= \mathrm{StepHeight}\cdot N_2 - s_{12}\\
		\theta_7 &= \arctan{\frac{u_2}{u_1}}\\
		\ddot{\theta_7} &= \frac{u_2^2 (-2  v_{11}  v_{12} - u_2  a_{11}) + u_1^2 (2  v_{11}  v_{12} + -u_2 a_{11}) + u_1^3  a_{12} - u_1  u_2  (2 v_{12}^2 - 2  v_{11}^2 - u_2  a_{12})}{(u_1^2 + u_2^2)^2}\\
		r_7 &= \frac{u_2}{l_{72}}\\
		F_{react71}' &= -\mu_{tail} F_{react72}'\\
		\vec{F}_{react7} &= \begin{bmatrix}
			-\cos{(\theta_7)} & -\sin{(\theta_7)} & 0\\
			\sin{(\theta_7)} & -\cos{(\theta_7)} & 0\\
			0 & 0 & 1
		\end{bmatrix} \vec{F}_{react71}'
	\end{align}
\end{subequations}
where $N_2$ is the number of the step that the tail makes contact with, $u_1$ and $u_2$ are the displacement from the 




Solving technique\\
Required torque\\
Required coefficient of friction\\




The device can climb up steps. In doing so, the wheels and tail make contact with different parts of the steps. In order to model the device, the overall movement is broken down into individual sequential motions.\\
The first motion is simple, the device rolls forward on a flat surface.\\
The second motion is referred to as climbing. The front wheel is blocked by a step and fixed in place. The tail pushes against the ground and the LIM starts rotating up the step. This motion ends when the LIM is vertical.\\
In the third motion, the top wheel falls forward onto the step and the bottom wheel rolls backwards until the top wheel lands. The distance that it rolls depends on the speed of the LIM and the height of the step. If the frame of the LIM hits the edge of the step, the device may slip backwards until the top wheel makes contact with the step. This motion ends when the top wheel is on the step.\\
In the fourth motion, the device pulls itself up the steps. The front wheel rests on the step while the back wheel is on the ground. The tail pushes against the ground and the bottom wheel lifts while the front wheel simultaneously rolls forward on the step. This motion ends when the top wheel reaches the next step.\\
The fifth motion is similar to the second motion, with the exception that the tail is angled further down to reach the ground.\\
The sixth motion is similar to the third motion, with the exception that the tail is angled further down to reach the ground.\\
The seventh motion deviates significantly from the previous motions. The front wheel starts on the next step while the bottom wheel starts on the previous step. The tail now contacts the edge of the previous step rather than the ground, which causes a significant force to pull the LIMs backwards. Because of this, unlike in the fourth motion, the front wheel will not initially roll forward on the next step. The back wheel will lift from below until it is at a certain angle above the front wheel, at which point the front wheel will start to roll forward, bringing it to the base of the next step.\\
The eighth motion is similar to the second motion, except the tail pushes against the edge of the previous step and the back wheel is already partially lifted. The back wheel then lifts up further until the LIM is vertical.\\
The ninth motion is similar to the sixth motion, except the tail pushes against the surface of the previous step instead of the ground.