\chapter{Analysis}

The objective of this analysis is to validate the model and the simulation. The required torque calculated in the maths model and simulated in Drake is compared with the experimental data to determine the validity of the maths model and the simulation.

\section{Qualitative comparison}

The motor torque over time for Stage 1 motion was recorded during the Drake simulation, and is shown in Figure \ref{fig:current-stage-1}. This shows a similar curve to the plot of recorded current, which is shown again in Figure \ref{fig:current-2}. The simulation completed Stage 1 in 2.8 s, which is faster than the real device which took 3.25 s. The noise in the simulated data is due to oscillations caused by Equation \ref{eq:torqueVoltageSpeed}, which acts as a proportional feedback controller on the speed in the simulation. This oscillation could be reduced by decreasing the simulation time step, however this would proportionally increase the simulation time taken, and a low time step of 0.01 ms is already selected. Both plots show a large spike as the motors are powered on and a slight dip before Stage 1 completes. This indicates that the torque produced by the device throughout the simulation accurately matches the torque that the real device would produce.
\begin{figure}[!ht]
	\centering
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=.9\linewidth]{plots/torque-stage-1}
		\caption{Torque recorded over time as the \\simulated device completes Stage 1.}
		\label{fig:torque-stage-1}
	\end{subfigure}%
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=.9\linewidth]{plots/current-stage-1}
		\caption{Current recorded over time as the device completes Stage 1.}
		\label{fig:current-2}
	\end{subfigure}
	\caption{Simulated current and recorded torque.}
	\label{fig:torque-current}
\end{figure}


\section{Quantitative comparison}

The torque measurement experiment gives two values for each stage of motion, the torque required to cause some partial movement, and the torque required to cause full movement. These values will be referred to as $T_\mathrm{Partial}$ and $T_\mathrm{Full}$ respectively, and are shown in Figure \ref{fig:torque-experiment}.\\

\begin{figure}[!h]
	\centering
	\includegraphics[width=0.8\textwidth]{plots/torque-experiment}
	\caption{Required torques for each stage determined experimentally}
	\label{fig:torque-experiment}
\end{figure}

In Figure \ref{fig:torque-experiment}, there are two points for each stage, the higher of which is $T_\mathrm{Full}$ and the lower is $T_\mathrm{Partial}$. In cases where only a single point is present, there was no torque that would cause a partial movement; meaning that if the torque is high enough to start the movement, it is also high enough to complete the movement. Stages 0, 2, and 5 are omitted as the device does not push against gravity in these stages, so the torque required is negligible.\\

To determine the required torque in the simulation, the torque measurement experiment is simulated. The torque required across each stage of motion has already been calculated using the maths model, as shown in Figure \ref{fig:bigplot}. The required torque at the start of each stage is equivalent to $T_\mathrm{Partial}$, as this is the torque that will cause the motion to start. The highest required torque for each stage is $T_\mathrm{Full}$, as if the device can output this torque it will be able to complete the full stage of motion. The required torque produced by the simulation and the maths model are shown side by side with the experimental data in Figure \ref{fig:torque-comparison}.\\

\begin{figure}[!h]
	\centering
	\includegraphics[width=0.8\textwidth]{plots/torque-comparison}
	\caption{Required torques for each stage from different sources.}
	\label{fig:torque-comparison}
\end{figure}

Figure \ref{fig:torque-comparison} shows that the model, simulation, and experiment all show similar trends but produce different values. In Stages 1, 4, and 6, the model and simulation both produce a lower required torque than the device actually needs. In Stage 3, the device needs less torque to complete the motion than the model and simulation predict.\\
To test the accuracy of the model and simulation across a range of design parameters, the experiment and comparison were repeated twice, once with a 60 cm long tail in place of the 30 cm one, and once with a 340 g mass attached to the body of the device. The comparison between these results are shown in Figures \ref{fig:torque-comparison-tail} and \ref{fig:torque-comparison-mass}. These plots show similar trends, indicating that the model and simulation give consistent results for a range of design parameters.

\begin{figure}
	\centering
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=.9\linewidth]{plots/torque-comparison-tail}
		\caption{Required torques for each stage when \\device has a 60 cm tail.}
		\label{fig:torque-comparison-tail}
	\end{subfigure}%
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=.9\linewidth]{plots/torque-comparison-mass}
		\caption{Required torques for each stage when \\device has an added 340 g mass.}
		\label{fig:torque-comparison-mass}
	\end{subfigure}
	\caption{Required torques for each stage from different sources, with varied design parameters.}
	\label{fig:torque-comparison-tailMass}
\end{figure}


 
\section{Assessment of error}

Table \ref{tab:error} shows the percentage error of the required torque produced by the model and simulation for the original device. Negative error indicates that the model or simulation produced a lower torque value than the experiment required. The simulation is shown to be more accurate than the maths model for most data points.\\
 

\begin{table}[!ht]
	\centering
	\caption{Percentage error of required torque for each stage of motion in the model and simulation.}
	\label{tab:error}
	\begin{tabular}{|l|l|l|l|l|l|l|l|l|}
		\hline
		~ & Stage 1 & ~ & Stage 3 & ~ & Stage 4 & ~ & Stage 6 & ~ \\ \hline
		~ & Partial & Full & Partial & Full & Partial & Full & Partial & Full \\ \hline
		Model & -16.1\% & -28.8\% & -20.5\% & 33.3\% & -14.1\% & -13.5\% & -43.5\% & -11.5\% \\ \hline
		Simulation & -14.5\% & -6.8\% & 5.1\% & 23.1\% & -30.8\% & -5.6\% & -24.2\% & -24.4\% \\ \hline
	\end{tabular}
\end{table}

The full torque required to complete Stage 4 motion is the most important to design around, as this is shown to be the highest torque the device will need. In this stage, the maths model has an error of -14.1\% and the simulation has an error of -5.6\%, which indicates that one should design for at least 16.4\% higher torque than the models suggest. However, other stages of motion show errors of up to 43.5\%, which is very high and indicates that there may be some incorrect assumptions in the models.\\

Identifying the source of the error is not essential for the purposes of informing design, one can simply design the motors to have at least 2 times the calculated required torque. However, analysing the source of this error is important in order to improve future versions of the model.\\

\begin{wrapfigure}{r}{0.35\textwidth}
	\centering
	\includegraphics[width=0.35\textwidth]{imbalanced-climbing}
	\caption{Device failing to climb as one LIM lifts ahead of the other}
	\label{fig:imbalanced-climbing}
\end{wrapfigure}

In Stage 1, the model predicts that there is no torque that will cause partial movement. As the device lifts the torque required decreases, so if the torque is high enough to start lifting, it is high enough to complete Stage 1 motion. However, Figure \ref{fig:torque-comparison} shows that there is a range of torques that produce partial motion in the experimental and simulated data. The most likely cause for this is that some assumption made in the maths model is invalid. Although the calculations are done differently, the simulation is subject to the same rigid body and friction assumptions as the maths model. The main discrepancy between the two is that the simulation allows motion in three dimensions while the model is limited to two. As there is a large difference between the results of the model and the simulation, it is likely that the three-dimensional movement is what allows the device to get stuck part way during Stage 1. Initial tests showed that if one of the LIMs moves ahead of the other, the device will tip slightly, putting more weight on the LIM that falls behind, preventing the LIM from lifting unless it has excessive torque. An example of this is shown in Figure \ref{fig:imbalanced-climbing}. It is likely that even when the LIMs appear to move in unison, a slight imbalance can cause the motion to stop part way when the motor torque is close to the required torque. To address this error, one could update the maths model to allow movement in three dimensions, however this would drastically increase the complexity and the calculation time of the model, and is excessive when tools for three-dimensional simulation such as Drake are readily available.\\

\begin{wrapfigure}{r}{0.35\textwidth}
	\centering
	\includegraphics[width=0.35\textwidth]{FBDs/Stage-3-LIM-contact}
	\caption{Frame of the LIM making contact with the edge of the step in Stage 3}
	\label{fig:Stage-3-LIM-contact}
\end{wrapfigure}
In Stage 3, the experiment shows that there is no torque that causes partial motion. However, the simulation indicates that there is a small range of torques that cause partial motion, and the maths model indicates that there is a large range of torques that cause partial motion. Both the simulation and the maths model also indicate that the required torque is higher than the experimental value. The reason for this error in the maths model is likely because it incorrectly assumes that the frame of the LIM will not come into contact with the step. When the device climbs in Stage 3, the frame of the LIM slides along the edge of the step while the front wheel pulls the device up the step, which is illustrated in Figure \ref{fig:Stage-3-LIM-contact}.
The step supports the frame of the LIM, so that the device needs less torque in order to overcome gravity, which explains why the actual device needs less torque to complete the stage of motion than the model predicted. Interestingly, the frame does not typically make contact with the step in Stage 6 because the backwards force from the tail on the step makes the LIMs favour lifting the rear wheel instead of rolling forward. To address this error, the model could be updated to model the contact between the step and the LIM frame, however this would be difficult to do analytically as the LIM frame has an irregular shape. The simulation does model the contact between the LIM frame and the step, however it still indicates that there should be partial movement and that the required torque is higher than the experimental value. Initially it was though that this was because the coefficient of friction between the LIM frame and the step is higher in the simulation than in reality, as it defaults to 1.0. However, inspection of the simulation revealed that in Stage 3 the front wheel simply does not roll forward when the the motor torque is low. The LIMs will rotate, lifting the back wheel, but the front wheel does not rotate forward so the frame of the LIM is never supported by the step. This may be because the teeth of the simulated gears do not mesh well and become stuck when the torque is not high enough. As stated in Section \ref{sec:construction}, the real gears had to be filed down in order to mesh well. This indicates that there may be a flaw in the design of the gears.\\

Another potential source of error comes from the calibration of the motors. The voltage torque calibration experiment in Section \ref{sec:Voltage-torque calibration} was used to produce Equation \ref{eqTorqueVoltage}, which was later used to calculate the experimental required torque from the measured voltage. An error in the calibration method could cause all of the experimental results to be off by a constant factor. The method of this experiment involved using the motors to lift a weight with a lever. Typically in this style of experiment, the motor torque would reach an equilibrium with the moment from the weight and the lever would stop moving. However, as the gearbox on the motors is self-locking, the lever cannot move in reverse. This means that if the lever ever lifts beyond the equilibrium point, it will not fall back to the equilibrium point and the recorded lever angle will be higher than the motors could actually output. There are two possible ways that the lever can lift beyond the equilibrium point in this experiment. Firstly, if the lever and the mass have a significant momentum when they reach the equilibrium point, they will move beyond it; this is mitigated by the high gear ratio on the motor which causes it to move quite slowly. Secondly, as the mass is attached to the lever by string, it can act as a pendulum. The swing of the pendulum will sometimes make it easier for the lever to lift, and sometimes make it harder. This combines with the self-locking gearbox to cause the lever to inch forward while the pendulum is helping it, then the gearbox locks when the pendulum swings the other way. This is visualised in Figure \ref{fig:lever-swinging}. The net result is that the lever moves slightly beyond the equilibrium point. \\

\begin{figure}[!h]
	\centering
	\includegraphics[width=0.6\textwidth]{FBDs/lever-swinging}
	\caption{Visualisation of the mass acting as a pendulum on the end of the lever.}
	\label{fig:lever-swinging}
\end{figure}

If the motors incorrectly calibrated and appear to produce more torque than they actually do, it would help explain why the experimental torques are higher than the modelled and simulated torques in Stages 1 and 3. This error could be mitigated by attaching the mass directly to the lever rather than by string.

